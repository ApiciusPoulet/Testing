#!/usr/bin/env php
<?php

$rootDir = realpath(__DIR__.'/../../../..');
$vendorDir = realpath($rootDir.'/vendor');
$phpUnitFile = $rootDir.'/phpunit.xml.dist';

if (!file_exists($phpUnitFile)) {
    throw new \Exception(sprintf(
        'Cannot find phpunit.xml.dist file in "%s"',
        $phpUnitFile
    ));
}

$xml = new \SimpleXMLElement(file_get_contents($phpUnitFile));
$kernelDir = $xml->php[0]->server[0]['value'];

$kernelFile = $kernelDir.'/AppKernel.php';

if (!file_exists($kernelFile)) {
    throw new \Exception(sprintf(
        'Cannot find kernel file "%s"',
        $kernelFile
    ));
}

require_once $vendorDir.'/symfony-cmf/testing/bootstrap/bootstrap.php';
require_once $kernelFile;

use Symfony\Bundle\FrameworkBundle\Console\Application;
use Symfony\Component\Console\Input\ArgvInput;

$kernel = new AppKernel('test', true);
$application = new Application($kernel);
$application->run();
